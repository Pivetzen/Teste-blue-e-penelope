<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ebook Dinâmico via Google Sheets</title>
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>
    <style>
        body { background-color: #1e1e1e; margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: 'Georgia', serif; }
        .container { width: 100%; max-width: 900px; display: flex; justify-content: center; align-items: center; padding: 20px; }
        #book { opacity: 0; transition: opacity 0.5s; } /* Esconde o livro até carregar os dados */
        .page { padding: 40px; background-color: #fdfdfd; border: 1px solid #ddd; display: flex; flex-direction: column; box-sizing: border-box; }
        .page-cover { background-color: #2c3e50; color: #ecf0f1; text-align: center; justify-content: center; }
        .page-image { width: 100%; height: 220px; margin-bottom: 20px; border-radius: 4px; object-fit: cover; }
        .text-container { line-height: 1.7; text-align: justify; font-size: 1.05em; }
        #progress-container { width: 80%; max-width: 600px; height: 8px; background-color: #444; border-radius: 4px; margin-top: 30px; }
        #progress-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #3498db, #2ecc71); transition: width 0.3s; }
        #page-counter { color: #ccc; margin-top: 10px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="container">
        <div class="flip-book" id="book">
            </div>
    </div>

    <div id="progress-container"><div id="progress-bar"></div></div>
    <div id="page-counter">Carregando conteúdo...</div>

    <script>
        // COLE O LINK DO SEU CSV PUBLICADO AQUI ABAIXO:
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSm0NV0OTbTbEz5xamgqRZzpkFBmDJNVFfl8UIQZYjCu6SOCZvGdAsobKFQZ2aVKEkZcd2jONOwtsX8/pub?output=csv";

        async function loadBook() {
            const response = await fetch(sheetURL);
            const data = await response.text();
            const rows = data.split('\n').slice(1); // Remove o cabeçalho
            const bookContainer = document.getElementById('book');

            // 1. Criar Capa
            bookContainer.innerHTML += `<div class="page page-cover" data-density="hard"><h1>Meu Ebook</h1><p>Carregado via Sheets</p></div>`;

            // 2. Criar Páginas Dinâmicas
            rows.forEach(row => {
                const columns = row.split(','); // Divide por vírgula
                if(columns.length >= 3) {
                    const [titulo, texto, imagem] = columns;
                    bookContainer.innerHTML += `
                        <div class="page">
                            <div class="page-content">
                                ${imagem.trim() ? `<img src="${imagem}" class="page-image">` : ''}
                                <div class="text-container">
                                    <h3>${titulo}</h3>
                                    <p>${texto}</p>
                                </div>
                            </div>
                        </div>`;
                }
            });

            // 3. Criar Contracapa
            bookContainer.innerHTML += `<div class="page page-cover" data-density="hard"><h2>FIM</h2></div>`;

            initFlip(bookContainer);
        }

        function initFlip(el) {
            const pageFlip = new St.PageFlip(el, {
                width: 450, height: 600, size: "stretch", showCover: true
            });
            pageFlip.loadFromHTML(document.querySelectorAll('.page'));
            el.style.opacity = "1";
            
            const total = pageFlip.getPageCount();
            document.getElementById('total-pages');

            pageFlip.on('flip', (e) => {
                const current = e.data + 1;
                document.getElementById('page-counter').innerText = `Página ${current} de ${total}`;
                document.getElementById('progress-bar').style.width = (current / total * 100) + "%";
            });
        }

        loadBook();
    </script>
</body>
</html>
