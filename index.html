<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue e Penélope</title>
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>

    <style>
        body { 
            background-color: #1a1a1a; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-family: 'Georgia', serif; 
            overflow: hidden;
        }

        .container { width: 100%; max-width: 950px; display: flex; justify-content: center; }
        #book { opacity: 0; transition: opacity 0.8s ease; }

        .page { 
            padding: 30px; 
            background-color: #fdfdfd; 
            border: 1px solid #ddd; 
            box-sizing: border-box; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            position: relative; /* Necessário para posicionar o autor no canto */
        }

        /* ESTILIZAÇÃO DA CAPA */
        .page-cover { 
            background-color: #2c3e50; 
            color: #ecf0f1; 
            text-align: center; 
        }

        .page-cover h1 {
            font-size: 2.2em;
            margin-top: 40px;
            margin-bottom: 5px;
            font-weight: bold;
            letter-spacing: -1px;
        }

        .page-cover p.subtitle {
            font-size: 1.1em;
            font-style: italic;
            opacity: 0.9;
            margin-top: 0;
        }

        .author-info {
            position: absolute;
            bottom: 20px;
            right: 25px;
            font-size: 0.85em;
            font-family: sans-serif;
            opacity: 0.8;
        }

        /* Padronização das imagens */
        .page-image { 
            width: 100%; 
            max-height: 280px; 
            margin-bottom: 15px; 
            border-radius: 4px; 
            object-fit: cover;
            display: block;
        }

        .page-cover .page-image {
            margin-top: 30px;
        }

        /* Ajuste do texto interno */
        .text-container { 
            line-height: 1.7; 
            text-align: justify; 
            font-size: 1.1em; 
            color: #333;
            white-space: pre-wrap;
            text-indent: 0 !important;
            margin: 0;
        }

        #ui-layer { width: 80%; max-width: 600px; text-align: center; margin-top: 30px; }
        #progress-container { width: 100%; height: 6px; background-color: #444; border-radius: 10px; overflow: hidden; }
        #progress-bar { width: 0%; height: 100%; background: #3498db; transition: width 0.4s ease; }
        #page-counter { color: #888; margin-top: 10px; font-family: sans-serif; font-size: 0.85em; }
    </style>
</head>
<body>

    <div class="container">
        <div id="book" class="flip-book"></div>
    </div>

    <div id="ui-layer">
        <div id="progress-container"><div id="progress-bar"></div></div>
        <div id="page-counter">Carregando história...</div>
    </div>

    <script>
        const jsonAppURL = "https://script.google.com/macros/s/AKfycbybe5Y0hFvUFVWoQFEIOWQkzqJN8dyo0CnECrJI7ICiMrEBY0Nc3X3LHknTCZcPsMB8/exec";

        async function initBook() {
            try {
                const response = await fetch(jsonAppURL);
                const data = await response.json();
                const bookEl = document.getElementById('book');

                // CAPA ATUALIZADA
                bookEl.innerHTML += `
                    <div class="page page-cover" data-density="hard">
                        <h1>Blue e Penélope em...</h1>
                        <p class="subtitle">Como tudo começou</p>
                        <img src="https://purina.com.br/sites/default/files/2025-09/racas-de-gato-mais-populares.jpg" class="page-image">
                        <div class="author-info">Autor: Matheus Maia</div>
                    </div>`;

                data.forEach((item) => {
                    const cleanText = item.texto ? item.texto.trim() : '';
                    const cleanTitle = item.titulo ? item.titulo.trim() : '';

                    bookEl.innerHTML += `<div class="page"><div class="page-content">${item.imagem ? `<img src="${item.imagem}" class="page-image">` : ''}<div class="text-container">${cleanTitle ? `<h3>${cleanTitle}</h3>` : ''}${cleanText}</div></div></div>`;
                });

                bookEl.innerHTML += `<div class="page page-cover" data-density="hard"><h2>FIM</h2></div>`;

                startFlipEngine();
            } catch (error) {
                document.getElementById('page-counter').innerText = "Erro ao carregar os dados.";
                console.error(error);
            }
        }

        function startFlipEngine() {
            const pageFlip = new St.PageFlip(document.getElementById('book'), {
                width: 450,
                height: 600,
                size: "stretch",
                showCover: true
            });
            pageFlip.loadFromHTML(document.querySelectorAll('.page'));
            document.getElementById('book').style.opacity = "1";
            const total = pageFlip.getPageCount();
            pageFlip.on('flip', (e) => {
                const current = e.data + 1;
                document.getElementById('page-counter').innerText = `Página ${current} de ${total}`;
                document.getElementById('progress-bar').style.width = (current / total * 100) + "%";
            });
        }

        initBook();
    </script>
</body>
</html>
