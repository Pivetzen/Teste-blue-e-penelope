<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ebook Dinâmico - Layout Compacto</title>
    
    <script src="https://cdn.jsdelivr.net/npm/page-flip@2.0.7/dist/js/page-flip.browser.js"></script>

    <style>
        body { 
            background-color: #1a1a1a; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            font-family: 'Georgia', serif; 
            overflow: hidden;
        }

        .container { 
            width: 100%; 
            max-width: 950px; 
            display: flex; 
            justify-content: center; 
        }

        #book { opacity: 0; transition: opacity 0.8s ease; }

        .page { 
            padding: 20px; /* Padding reduzido */
            background-color: #fdfdfd; 
            border: 1px solid #ddd; 
            box-sizing: border-box; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
        }

        .page-cover { 
            background-color: #2c3e50; 
            color: #ecf0f1; 
            text-align: center; 
            justify-content: center; 
        }

        .page-image { 
            width: 100%; 
            max-height: 280px; 
            margin-bottom: 8px; /* Espaço mínimo entre imagem e texto */
            border-radius: 4px; 
            object-fit: cover; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* REMOVENDO ESPAÇAMENTO INICIAL */
        .text-container { 
            line-height: 1.6; 
            text-align: justify; 
            font-size: 1.05em; 
            color: #333;
            white-space: pre-wrap;
            margin: 0; /* Remove margens externas do container */
        }

        /* Remove margem superior do primeiro parágrafo ou título da página */
        .text-container h3:first-child,
        .text-container p:first-child,
        .text-container:first-child {
            margin-top: 0 !important;
            padding-top: 0 !important;
        }

        h3 {
            margin: 0 0 8px 0; 
            font-size: 1.2em;
            color: #2c3e50;
        }

        /* UI de Progresso */
        #ui-layer { width: 80%; max-width: 600px; text-align: center; margin-top: 30px; }
        #progress-container { 
            width: 100%; 
            height: 6px; 
            background-color: #444; 
            border-radius: 10px; 
            overflow: hidden; 
        }
        #progress-bar { 
            width: 0%; 
            height: 100%; 
            background: #3498db; 
            transition: width 0.4s ease; 
        }
        #page-counter { color: #888; margin-top: 10px; font-family: sans-serif; font-size: 0.85em; }
    </style>
</head>
<body>

    <div class="container">
        <div id="book" class="flip-book">
            </div>
    </div>

    <div id="ui-layer">
        <div id="progress-container"><div id="progress-bar"></div></div>
        <div id="page-counter">Carregando conteúdo...</div>
    </div>

    <script>
        // SUBSTITUA PELO SEU URL DO APPS SCRIPT
        const jsonAppURL = "https://script.google.com/macros/s/AKfycbybe5Y0hFvUFVWoQFEIOWQkzqJN8dyo0CnECrJI7ICiMrEBY0Nc3X3LHknTCZcPsMB8/exec";

        async function initBook() {
            try {
                const response = await fetch(jsonAppURL);
                const data = await response.json();
                const bookEl = document.getElementById('book');

                // Capa Inicial
                bookEl.innerHTML += `
                    <div class="page page-cover" data-density="hard">
                        <h1>Meu Livro Digital</h1>
                        <p>Alimentado via Google Sheets</p>
                    </div>`;

                // Páginas Dinâmicas
                data.forEach((item) => {
                    // Limpando espaços em branco extras do texto da planilha
                    const cleanText = item.texto ? item.texto.trim() : '';
                    const cleanTitle = item.titulo ? item.titulo.trim() : '';

                    bookEl.innerHTML += `
                        <div class="page">
                            <div class="page-content">
                                ${item.imagem ? `<img src="${item.imagem}" class="page-image">` : ''}
                                <div class="text-container">
                                    ${cleanTitle ? `<h3>${cleanTitle}</h3>` : ''}
                                    ${cleanText}
                                </div>
                            </div>
                        </div>`;
                });

                // Contracapa
                bookEl.innerHTML += `<div class="page page-cover" data-density="hard"><h2>FIM</h2></div>`;

                startFlipEngine();
            } catch (error) {
                document.getElementById('page-counter').innerText = "Erro ao carregar dados.";
                console.error(error);
            }
        }

        function startFlipEngine() {
            const pageFlip = new St.PageFlip(document.getElementById('book'), {
                width: 450,
                height: 600,
                size: "stretch",
                showCover: true
            });

            pageFlip.loadFromHTML(document.querySelectorAll('.page'));
            document.getElementById('book').style.opacity = "1";

            const total = pageFlip.getPageCount();
            
            pageFlip.on('flip', (e) => {
                const current = e.data + 1;
                document.getElementById('page-counter').innerText = `Página ${current} de ${total}`;
                document.getElementById('progress-bar').style.width = (current / total * 100) + "%";
            });
        }

        initBook();
    </script>
</body>
</html>
